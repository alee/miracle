<template id='project-detail-form'>
    <form class='form-horizontal' data-bind='submit: saveProjectDetails'>
        {% csrf_token %}
        <div class='form-group'>
            <label for='name' class='control-label col-sm-2'>Short name</label>
            <div class='col-sm-8'>
                <input type='text' data-bind='value: name' class='form-control' id='name' placeholder='Short name'>
            </div>
        </div>
        <div class='form-group'>
            <label for='fullName' class='control-label col-sm-2'>Full name</label>
            <div class='col-sm-8'>
                <input type='text' data-bind='value: full_name' class='form-control' id='fullName' placeholder='Full name'>
            </div>
        </div>
        <div class='form-group'>
            <label for='description' class='control-label col-sm-2'>Description</label>
            <div class='col-sm-8'>
                <textarea class='form-control' rows="6" data-bind='value: description'></textarea>
            </div>
        </div>
        <div class='form-group'>
            <div class='col-sm-offset-2 col-sm-8'>
                <div class='checkbox'>
                    <label>
                        <input type='checkbox' data-bind='value: is_published'>
                        Published?
                    </label>
                </div>
            </div>
            <div data-bind='if: is_published()'>
                Published on <mark data-bind='text: published_on'></mark>
            </div>
        </div>
        <div class='form-group'>
            <div class='col-sm-offset-2 col-sm-8'>
                <button type='submit' class='btn btn-primary'><i class='fa fa-save'></i> Save</button>
            </div>
        </div>
    </form>
</template>
<script>
function ProjectModel(params) {
    console.log("constructing project view model from params");
    console.log(params);
    var model = ko.mapping.fromJS(params.data);
    model.saveRequestType = ko.pureComputed(function() {
        return model.pk() > -1 ? "PUT" : "POST";
    });
    model.saveUrl = ko.pureComputed(function() {
        return model.pk() == -1 ? "/projects/" : "/project/" + model.pk();
    });
    model.saveProjectDetails = function() {
        var json = ko.toJSON(model);
        $.ajax({
            url: model.saveUrl(),
            type: model.saveRequestType(),
            data: json,
        }).done(function(response) {
            console.debug("SUCCESS");
            console.debug(response);
        }).fail(function(jqxhr, textStatus, errorThrown) {
            console.debug("failed %s (%s)", textStatus, errorThrown);

        });
        return false;
    }
    return model;
}
ko.components.register('project-detail-form', {
    viewModel: ProjectModel,
    template: { element: 'project-detail-form' }
});
</script>
