{% extends "base.html" %}

{% block content %}
<div class='panel panel-default'>
    <div class='panel-heading'>
        <h4 class='panel-title'>Projects 
            <span class='btn btn-primary btn-xs' data-bind='click: createNewProject'><i class='fa fa-plus'></i> New</span>
        </h4>
    </div>
    <div class='panel-body dynamic-content' data-bind='template: {name: templateId()}'>
    </div>
</div>
{% endblock content %}

{% block javascript %}
{% include "includes/ko.js" %}
{% include "project/includes/detail-form.html" %}
<script type='text/template' id='project-list'>
    <div data-bind='if: projects().length'>
        <table class='table striped'>
            <thead>
                <th class='col-md-4'>Name</th>
                <th class='col-md-4'>Description</th>
                <th class='col-md-2'>Owner</th>
                <th class='col-md-2'>Date created</th>
            </thead>
            <tbody data-bind='foreach: projects'>
            <tr>
                <td><a data-bind='attr: {href: detail_url}, text: name'></a></td>
                <td data-bind='text: description'></td>
                <td data-bind='text: creator'></td>
                <td data-bind='text: date_created'></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div data-bind='ifnot: projects().length'>
    <div class='alert alert-success'>
    No available projects. <span class='btn btn-warning' data-bind='click: createNewProject'><i class='fa fa-plus'></i> Create one?</span>
    </div>
    </div>
</script>
<script type='text/template' id='new-project'>
    <div data-bind='component: {name: "project-detail-form", params: {data: createProject()}}'>
    </div>
</script>
<script>
var projectArray = $.parseJSON("{{ project_list_json | escapejs }}");
var g;
$(function() {
    function ProjectListModel(projectArray) {
        var self = this;
        var model = ko.mapping.fromJS({projects: projectArray});
        model.templateId = ko.observable('project-list');
        model.createNewProject = function() {
            model.templateId('new-project');
        }
        model.createProject = function() {
            return {
                pk: -1,
                name: ko.observable(""),
                full_name: ko.observable(""),
                description: ko.observable(""),
                is_published: ko.observable(false),
            };
        }
        return model;
    }
    var model = new ProjectListModel(projectArray);
    g = model;
    ko.applyBindings(model);
    document.documentElement.className = "js";
});
</script>

{% endblock javascript %}
